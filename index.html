<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FLAMES Compatibility Test | MatchMaker</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Add specific styles for the result */
        .result-box {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
        }
        .result-box.F { background-color: #ffcccc; color: #cc0000; } /* Friends */
        .result-box.L { background-color: #ffe6cc; color: #ff6600; } /* Lovers */
        .result-box.A { background-color: #ccffcc; color: #009900; } /* Affectionate */
        .result-box.M { background-color: #cce6ff; color: #0066cc; } /* Marriage */
        .result-box.E { background-color: #ffffcc; color: #cc9900; } /* Enemies */
        .result-box.S { background-color: #e6ccff; color: #9900cc; } /* Siblings */
        .download-link {
            display: block;
            margin-top: 15px;
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-size: 1em;
        }
    </style>
</head>
<body>
    <header>
        <h1>FLAMES Compatibility Test</h1>
        <p>Enter two names to reveal your destiny!</p>
    </header>

    <main>
        <div class="form-container">
            <h2>Test Your Link</h2>
            <form id="flamesForm">
                <div class="input-group">
                    <label for="nameA">Name (Person A):</label>
                    <input type="text" id="nameA" name="nameA" required>
                </div>

                <div class="input-group">
                    <label for="nameB">Name (Person B):</label>
                    <input type="text" id="nameB" name="nameB" required>
                </div>

                <button type="submit">Reveal Compatibility</button>
            </form>
            
            <div id="result" class="hidden">
                <div id="compatibilityResult" class="result-box"></div>
                <p>
                    <a id="downloadData" class="download-link" href="#" download="compatibility_log.csv">Download Data Log</a>
                    <span style="font-size: 0.8em; display: block; margin-top: 5px;">(This is how we collect the data without a backend.)</span>
                </p>
            </div>
        </div>
    </main>

    <footer>
        <p>&copy; 2025 MatchMaker Inc. | <a href="admin.html">Admin</a></p>
    </footer>

    <script>
    // ⚠️ IMPORTANT: PASTE YOUR DEPLOYED WEB APP URL HERE ⚠️
    const GOOGLE_SHEET_WEB_APP_URL = 'PASTE_YOUR_DEPLOYED_APPS_SCRIPT_URL_HERE'; 

    // Compatibility Test Logic (Simulated FLAMES)
    function calculateCompatibility(name1, name2) {
        // ... (Keep the previous FLAMES logic)
        const F = "Friends";
        const L = "Lovers";
        const A = "Affectionate";
        const M = "Marriage";
        const E = "Enemies";
        const S = "Siblings";
        const FLAMES = [F, L, A, M, E, S];
        const FLAMES_short = ['F', 'L', 'A', 'M', 'E', 'S'];

        const nameA_clean = name1.toLowerCase().replace(/[^a-z]/g, '');
        const nameB_clean = name2.toLowerCase().replace(/[^a-z]/g, '');

        // Simple logic: total length of unique characters
        let combined = nameA_clean + nameB_clean;
        let unique = Array.from(new Set(combined.split(''))).join('');
        const length = unique.length;
        
        // Use modulo operator to map the length to one of the 6 results
        const index = length % 6; 
        
        return {
            result: FLAMES[index],
            short: FLAMES_short[index]
        };
    }

    document.getElementById('flamesForm').addEventListener('submit', function(event) {
        event.preventDefault();
        
        const nameA = document.getElementById('nameA').value.trim();
        const nameB = document.getElementById('nameB').value.trim();
        
        if (!nameA || !nameB) return;

        // 1. Calculate Result
        const { result, short } = calculateCompatibility(nameA, nameB);

        // 2. Display Result
        const resultBox = document.getElementById('compatibilityResult');
        resultBox.innerHTML = `Compatibility: **${result}** (${short})`;
        resultBox.className = `result-box ${short}`;
        document.getElementById('result').classList.remove('hidden');

        // 3. Log Data to Google Sheet
        logDataToSheet(nameA, nameB, result);
    });
    
    // Function to send data to the Google Apps Script endpoint
    function logDataToSheet(nameA, nameB, result) {
        const data = {
            nameA: nameA,
            nameB: nameB,
            result: result
        };

        // Use URLSearchParams to format data for the Apps Script (key=value&key2=value2)
        const formData = new URLSearchParams(data).toString();

        fetch(GOOGLE_SHEET_WEB_APP_URL, {
            method: 'POST',
            mode: 'no-cors', // Required for Google Apps Script endpoint
            cache: 'no-cache',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: formData 
        })
        .then(response => {
            // Note: Due to 'no-cors', we can't read the response body reliably, 
            // but the request is sent successfully.
            console.log('Data logged to Google Sheet.');
        })
        .catch(error => {
            console.error('Error logging data:', error);
            alert('Failed to log data. Check console for details.');
        });
    }
</script>
</body>
</html>
